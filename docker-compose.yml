services:
  # --- 1. Python Backend Service (AgrIA_server) ---
  backend:
    build:
      context: ./AgrIA_server
      dockerfile: Dockerfile
    container_name: agria_backend
    ports:
      # Host port (e.g., 5000) : Container port (e.g., 5000)
      - "${DOCKER_PORT}:${API_PORT}" 
    
    env_file:
      - ./.env 
      
    # Ensure EXPOSE 5000 is in your AgrIA_server/Dockerfile to match API_PORT
    networks:
      - agria_network
    restart: always

  # --- 2. Angular Frontend Service (AgrIA_UI) ---
  frontend:
    build:
      context: ./AgrIA_UI
      dockerfile: Dockerfile
      args: 
        - API_URL=${DOCKER_BACKEND_URL}
    container_name: agria_frontend
    ports:
      # Use UI_PORT from the .env file
      # Host port (e.g., 4200) : Container port (Nginx default 80)
      - "${UI_PORT}:80"
      
    # Angular app needs the Docker DNS name for the backend
    environment:
      # Use the variable DOCKER_BACKEND_URL which should be /api/
      API_BASE_URL: ${DOCKER_BACKEND_URL} 
      
    networks:
      - agria_network
    depends_on:
      - backend

# --- 3. Define the internal network ---
networks:
  agria_network:
    driver: bridge