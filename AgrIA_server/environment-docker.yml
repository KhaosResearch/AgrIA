name: agria_server_env

channels:
  - pytorch
  - conda-forge
  - defaults

dependencies:
  - python=3.11

  # Core scientific stack
  - numpy<2        # Torch compatibility
  - pandas

  # Web / deployment
  - gunicorn

  # Geospatial stack (conda binaries = safer in Docker)
  - geopandas
  - shapely
  - pyproj
  - rasterio
  - fiona
  - gdal

  # PyTorch CPU-only (portable, no CUDA assumptions)
  - pytorch=2.4.*
  - torchvision

  # Utilities
  - pip

  - pip:
      # Backend
      - flask
      - flask-cors
      - python-dotenv
      - google-genai
      - structlog
      - minio
      - requests

      # Data / imaging
      - matplotlib
      - pillow
      - opencv-python<4.12
      - scikit-image
      - rioxarray
      - sentinelhub
      - safetensors
      - protobuf

      # Dev / QA (optional in prod image)
      - pytest
      - pytest-mock
      - flake8
      - autopep8

      # --- External tools ---
      - git+https://github.com/KhaosResearch/sen2sr-tools.git@main
      - git+https://github.com/KhaosResearch/sigpac-tools.git@dev
